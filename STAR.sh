#!/bin/sh
#$ -S /bin/sh

export PATH=${PATH}:/path/to/tools/STAR/STAR-2.7.3a/bin/
export LD_LIBRARY_PATH=/usr/lib/:${LD_LIBRARY_PATH}

ulimit -v 9999999999999

cd /path/to/GEUV/YRI/fastq/
for file in ERR188120 ERR188128 ERR188129 ERR188131 ERR188139 ERR188143 ERR188151 ERR188158 ERR188162 ERR188165 ERR188170 ERR188174 ERR188178 ERR188182 ERR188183 ERR188184 ERR188193 ERR188200 ERR188207 ERR188209 ERR188211 ERR188214 ERR188221 ERR188223 ERR188225 ERR188232 ERR188234 ERR188243 ERR188261 ERR188268 ERR188269 ERR188273 ERR188275 ERR188278 ERR188283 ERR188284 ERR188292 ERR188298 ERR188306 ERR188311 ERR188313 ERR188322 ERR188344 ERR188352 ERR188363 ERR188364 ERR188365 ERR188367 ERR188373 ERR188375 ERR188390 ERR188392 ERR188409 ERR188421 ERR188422 ERR188423 ERR188427 ERR188434 ERR188440 ERR188442 ERR188444 ERR188447 ERR188449 ERR188451 ERR188454 ERR188459 ERR188460 ERR188463 ERR188471 ERR188476;
do
    echo "${file}_R1_QC.fastq.gz" "${file}_R2_QC.fastq.gz"
    mkdir "${file}_combined_STAR_GRCh38"
    STAR --outFilterType BySJout \
    --runThreadN 24 \
    --outSAMtype BAM SortedByCoordinate \
    --genomeDir /path/to/Homo_sapiens_NCBI_GRCh38/Homo_sapiens/NCBI/GRCh38/Sequence/STARindex \
    --sjdbGTFfile /path/to/Homo_sapiens_NCBI_GRCh38/Homo_sapiens/NCBI/GRCh38/Annotation/Archives/archive-2015-08-11-09-31-31/Genes/genes.gtf \
    --outFileNamePrefix /path/to/GEUV/YRI/fastq/"${file}_combined_STAR_GRCh38"/ \
    --readFilesCommand gunzip -c \
    --readFilesIn /home/ykochi/GEUV/YRI/fastq/"${file}_R1_QC.fastq.gz" /home/ykochi/GEUV/YRI/fastq/"${file}_R2_QC.fastq.gz"
done > STAR_GRCh38_mapping_log2.txt 2>&1

export PATH=${PATH}:/path/to/bin/
for file in ERR188120 ERR188128 ERR188129 ERR188131 ERR188139 ERR188143 ERR188151 ERR188158 ERR188162 ERR188165 ERR188170 ERR188174 ERR188178 ERR188182 ERR188183 ERR188184 ERR188193 ERR188200 ERR188207 ERR188209 ERR188211 ERR188214 ERR188221 ERR188223 ERR188225 ERR188232 ERR188234 ERR188243 ERR188261 ERR188268 ERR188269 ERR188273 ERR188275 ERR188278 ERR188283 ERR188284 ERR188292 ERR188298 ERR188306 ERR188311 ERR188313 ERR188322 ERR188344 ERR188352 ERR188363 ERR188364 ERR188365 ERR188367 ERR188373 ERR188375 ERR188390 ERR188392 ERR188409 ERR188421 ERR188422 ERR188423 ERR188427 ERR188434 ERR188440 ERR188442 ERR188444 ERR188447 ERR188449 ERR188451 ERR188454 ERR188459 ERR188460 ERR188463 ERR188471 ERR188476;
do
    echo "${file}"
    cd /path/to/GEUV/YRI/fastq/"${file}_combined_STAR_GRCh38"/
    samtools sort -@ 20 Aligned.sortedByCoord.out.bam -o "${file}_combined_sorted_GRCh38.bam"
    rm Aligned.sortedByCoord.out.bam
    samtools index -@ 12 "${file}_combined_sorted_GRCh38.bam"
done